config defaults
        option syn_flood '1'
        option input 'REJECT'
        option output 'ACCEPT'
        option forward 'REJECT'

config zone
        option name 'lan'
        option input 'ACCEPT'
        option output 'ACCEPT'
        option forward 'ACCEPT'
        list network 'lan'
        list network 'iptv_lan'

config zone
        option name 'wan'
        option input 'REJECT'
        option output 'ACCEPT'
        option forward 'REJECT'
        option masq '1'
        option mtu_fix '1'
        list network 'wan'
        list network 'wan6'

config zone
        option name 'iptv'
        option input 'REJECT'
        option output 'ACCEPT'
        option forward 'REJECT'
        option masq '0'
        list network 'iptv'

config forwarding
        option src 'lan'
        option dest 'wan'

# Разрешаем IGMP от upstream (iptv) — чтобы мультикаст проходил в локальную сеть через igmpproxy
config rule
        option name 'Allow-IPTV-IGMP'
        option src 'iptv'
        option proto 'igmp'
        option target 'ACCEPT'
        option family 'ipv4'

# Разрешаем мультикаст-udp (тот же 224.0.0.0/4) от провайдера в локальную сеть
config rule
        option name 'Allow-IPTV-Multicast-UDP'
        option src 'iptv'
        option proto 'udp'
        option dest 'iptv_lan'
        option dest_ip '224.0.0.0/4'
        option target 'ACCEPT'

# Если приставке нужны DNS/DHCP ответы через WAN (обычно нет), но оставляем DHCP rules для WAN
config rule
        option name 'Allow-DHCP-Renew'
        option src 'wan'
        option proto 'udp'
        option dest_port '68'
        option target 'ACCEPT'
        option family 'ipv4'

config rule
        option name 'Allow-Ping'
        option src 'wan'
        option proto 'icmp'
        option icmp_type 'echo-request'
        option family 'ipv4'
        option target 'ACCEPT'

config rule
        option name 'Allow-IGMP'
        option src 'wan'
        option proto 'igmp'
        option family 'ipv4'
        option target 'ACCEPT'

config rule
        option name 'Allow-DHCPv6'
        option src 'wan'
        option proto 'udp'
        option dest_port '546'
        option family 'ipv6'
        option target 'ACCEPT'

config rule
        option name 'Allow-MLD'
        option src 'wan'
        option proto 'icmp'
        option src_ip 'fe80::/10'
        list icmp_type '130/0'
        list icmp_type '131/0'
        list icmp_type '132/0'
        list icmp_type '143/0'
        option family 'ipv6'
        option target 'ACCEPT'
